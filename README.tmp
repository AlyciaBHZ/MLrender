# ML Concept Designer (ML-CD)

## ML Concept Designer (ML-CD) - ??????(????)
- ????:Part 5 - ?????????

### ??(MVP ??)
- ??????:?????????????
- ????:Input/FC/Conv/Pooling/RNN/Output/Loss/Optimizer ?
- ???:????????(??)
- ????:??/??/??????????/??
- ????:??????(?)???????
- ????:???? formulaLabel + KaTeX ??
- ????:JSON(??/??)?CSV(Export to Sheets)?PNG(??)
- ???:?????/??????Fit/Center ?

**[P1: ???????]**
- [x] P1.1 ?????? (Resizable Nodes)
- [x] P1.2 ????????? (LaTeX/Markdown)
- [x] P1.3 ??????? (Edge Properties Panel)

**[P2: ??????]**
- [x] P2.1 ????? (i18n) ??
?????:?????????? Web ???,??????????????????????????????????
 - [x] P2.2 ????????? (Snap to Grid)
 - [x] P2.3 ??????? (????)

**[?????]**
- [x] Vite + React + TypeScript ?????

??(Vision):???????????????? BioRender for ML/AI?

??(Problems):????????(PPT/Visio/Draw.io)??? ML ??????????????????????????

??????:????(Drag-and-Drop)??????,????? AI Prompt-to-Diagram,??“?????”?

## ????
- ??:Node.js 18+
- ??:`npm install`
- ??:`npm run dev` ? ?? `http://localhost:5173`
- ??:`npm run build`

## ??????? (P3.2 / P3.3 / P5.1)
- ????: 2025-10-14
- P3.2 ??/?? (F_ALIGN): [x] ??? — ? `src/components/Toolbar.tsx`;???????“Update: P3.2 (F_ALIGN)”?
- P3.3(???): [ ] ??? — ???:?????????,????????????
- P5.1(???): [ ] ??? — ???:????(?:??/??/???),?????????

????(???):
- ?????????/??/????,??????????“Update:”????????
- ??????????,?????????,????????
- ????:`npm run progress:date` ??????“????”?

## ???(Core Technology Stack)
- React 18 + TypeScript 5
- Vite 5 + @vitejs/plugin-react
- Tailwind CSS 3 + PostCSS + Autoprefixer
- React Flow 11(????????????DnD)
- Zustand 4(????)
- html-to-image(PNG ??)

????
- ????:React + TypeScript ??????????????????
- ????:Vite ?????????(ESM + HMR)?
- ????:React Flow ??????????(????????)?
- ??:Tailwind CSS ????????????? UI ???
- ????:Zustand ??????,????????

## ????(????)
- `src/diagram/DiagramCanvas.tsx` ???????
- `src/diagram/DiagramState.ts` ????(nodes/edges/??)
- `src/nodes/*` ???????
- `src/edges/*` ????(????)
- `src/components/*` Sidebar/Toolbar/PropertiesPanel ? UI
- `src/sheets/*` Export to Sheets(CSV/JSON ????)
- `docs/????.md` ????????

## ????(??????)
??? Prompt ?????,?? [x]/[ ] ??:

??????:Part 5 ??????

??? [x]
- [x] ??????:??????(QuickPanel ??),??????
- [x] LaTeX/????:?? KaTeX(CDN),?????? LaTeX ??(???)
- [x] P1.2(F_LATEX): ??????(formulaLabel + KaTeX),PropertiesPanel ??“????(??)”\n- [x] ???????:??????????(QuickPanel)
- [x] ?????(i18n):??????(??/English),??????
- [x] ??????:????(Input/FC/Conv/Pooling/RNN/Output/Loss/Optimizer)
- [x] ???:??/???????
- [x] ????:??/??/????????????
- [x] ????:???/????(????????)
- [x] ?? PNG(html-to-image)
- [x] ???? JSON({ nodes, edges })
- [x] Export to Sheets:?? `nodes.csv`/`edges.csv`,?????
- [x] ???(??/??/??/?? ?????)
- [x] ?????:React 18/TS 5/Vite 5/Tailwind 3/React Flow 11/Zustand 4
- [x] ??:????? `docs/????.md`(????????????????)

?? [ ]
- [ ] ??/??;??????????;??????
- [ ] ??????(CNN/RNN/Transformer ????)
- [ ] ??/??/?????;???????
- [ ] ????(??/??/??)
- [ ] ?? SVG/Mermaid;????(????/URL ??)
- [ ] ???(?/?)???????
- [ ] Export to Sheets ??:CSV ???????;?????;(??)Google Sheets ??
- [ ] Prompt-to-Diagram ?????(?????????)
- [ ] README ??????? UTF-8/??(????????????)

## ??????
- ????:`src/components/MathText.tsx`(LaTeX ??),`src/components/QuickPanel.tsx`(??????),`src/components/LangSwitch.tsx`(????)
- ?????? LaTeX:?? `src/nodes/*Node.tsx` ??? `MathText`
- ??????:????????(JSON/CSV ???),?? QuickPanel ??????
- ???????:QuickPanel ??????????;?????? `label`
- ?? i18n:?? `src/i18n/`,?????? UI(???)
- CSV Schema ??:`src/sheets/schema.ts` ?? `height`;??????????
- LaTeX ??:? `index.html` ?? KaTeX CSS/JS(CDN),??????????
 - P1.1(F_RES):?? PropertiesPanel ????,?? React Flow ?? NodeResizer,?????????(FC/Conv/Data/Box/Circle/Tensor/Activation)????????;?? `@reactflow/node-resizer` ??? `src/main.tsx`

## ????(Examples)
- ???????:??????????????
- ???????:??????????????????????
- ???? JSON/CSV ????????????

## ?????
- ????????:`docs/????.md`


- P1.2(F_LATEX):
  - ???????? data.formulaLabel: string
  - ? src/components/PropertiesPanel.tsx ??“????(??)”???
  - ?????????:?? formulaLabel ?? KaTeX ??
  - ??:??????? react-latex-next,???? MathText + KaTeX ????????????,???????????


## Update: P1.3 (F_EDGE_PROP)
- PropertiesPanel: edge-specific editor now includes color picker and text label input.
- State Sync: updates propagate via updateEdge to React Flow state (style.stroke, edge.label).

## Update: P2.1 (F_I18N)
- Added i18next + react-i18next (update package.json). Run `npm install` to fetch dependencies.
- Initialized i18n in `src/i18n/index.ts` with locales:
  - `src/i18n/locales/en/translation.json`
  - `src/i18n/locales/zh/translation.json`
- Wired up in `src/main.tsx` via `import './i18n'`.
- Toolbar now includes a language switch; labels in PropertiesPanel/Toolbar begin using `t()`.

## Update: P1.2 (F_LATEX) — Code References
- KaTeX assets: `index.html:8` (CDN stylesheet and script)
- Formula input: `src/components/PropertiesPanel.tsx` adds “????(??)” bound to `data.formulaLabel`
- Renderer: `src/components/MathText.tsx` uses `window.katex` to render; falls back to plain text on errors
- Example node rendering: `src/nodes/FCNode.tsx` chooses `formulaLabel` (KaTeX) or `label` (text)

## Update: P2.2 (F_GRID)
- Snap to Grid: already enabled via React Flow props snapToGrid and snapGrid bound to store.
- Dot Grid Background: enabled with <Background variant={Dots} gap={snapGrid[0]} size={1} color="#d1d5db" /> in src/diagram/DiagramCanvas.tsx.
- Grid size can be adjusted from the header input (Grid), snapping can be toggled (Snap).

## Update: P2.3 (F_CODE)
- Refactored custom nodes to align types and behavior:
  - Added ormulaLabel?: string to all node data types.
  - Replaced (data as any) access with typed properties.
  - Ensured consistent NodeResizer usage and min sizes across nodes.
  - Kept label rendering consistent: formulaLabel via KaTeX when present; fallback to label.
- Files: src/nodes/*Node.tsx (FC/Box/Conv/Data/Circle/Tensor/Activation)

## ML Concept Designer (ML-CD) - ??????
- ??????:Part 5 ??????
- ????
  - [x] P1.1(F_RES)??????(NodeResizer),??????
  - [x] P1.2(F_LATEX)??????:formulaLabel + KaTeX ?? + ????
  - [x] P1.3(F_EDGE_PROP)?????:???????
  - [x] P2.1(F_I18N)?? i18n:i18next/react-i18next ?????
  - [x] P2.2(F_GRID)???? + ??????
  - [x] P2.3(F_CODE)????????????

????(?)
- ??:??“??????”??,??????????


## Update: P3.2 (F_ALIGN)
- Added icon-based alignment/distribution controls to toolbar
- Added a compact align/distribute group near the Undo/Redo shortcut area for quick access
- File: `src/components/Toolbar.tsx`
- Added exported helpers: `AlignLeft`, `AlignTop`, `DistributeHorizontal`, `DistributeVertical` in `src/diagram/alignment.ts`

## Update: P3.3 (F_GROUP)
- Added new group node type `groupNode` with dashed rectangle border
- Files:
  - `src/nodes/GroupNode.tsx`
  - `src/diagram/DiagramCanvas.tsx` (registered in `nodeTypes`)
- Grouping actions in store:
  - `groupSelectedIntoNewGroup(label?)`: wrap selected nodes into a new group node (auto size with padding)
  - `groupSelectedInto(groupId)`: move selected nodes into an existing group
  - `ungroupSelected()`: lift selected nodes out to root coordinates
- Toolbar: added grouping buttons (Group/Ungroup) near the alignment cluster — `src/components/Toolbar.tsx`
- Added helper: `groupSelectedNodes(label?)` in `src/diagram/alignment.ts` (wraps store action)
 - Added utilities: `getSelectedBounds()` and `createGroupNodeFromSelection(label?, padding?)` in `src/diagram/grouping.ts`
## Update: P3.1 (F_UNDO) — UI Integration
- Added Undo/Redo buttons in toolbar (? / ?), with keyboard shortcuts preserved.
- File: `src/components/Toolbar.tsx`
## Update: P3.1 (F_UNDO) — API Exposure
- Exposed store methods: undo() and redo() for external usage
- Files:
  - src/diagram/DiagramState.ts — methods are included in the store API
  - src/App.tsx — keyboard shortcuts call useDiagramStore.getState().undo()/redo()
## Update: CSV Schema — formulaLabel persistence
- Nodes CSV adds ormula column (after label)
- Export: src/sheets/export.ts writes data.formulaLabel to ormula
- Import: src/sheets/import.ts reads ormula into data.formulaLabel

## Update: PropertiesPanel i18n cleanup
- Rewrote src/components/PropertiesPanel.tsx to use i18next (	())
- Unified labels for node/edge editors and removed garbled strings

### ????(P3/P4 ??,?????)
- ??:?????????????,????????????????
- [ ] P3.1(???)
- [ ] P3.2(???)
- [ ] P3.3(???)
- [ ] P3.4(???)
- [ ] P4.1(???)

## Update: P3.1 (F_UNDO)
- Added undo/redo history to Zustand store with past/future stacks (max 50).
- Wrapped mutating actions to record snapshots; skip during undo/redo.
- Keyboard shortcuts: Ctrl/Cmd+Z (undo), Shift+Ctrl/Cmd+Z (redo).
- Files: src/diagram/DiagramState.ts, src/App.tsx (key handler)

## Update: P3.1 (F_UNDO) — Middleware
- Wrapped Zustand store with devtools middleware for better debugging.
- File: src/diagram/DiagramState.ts (create(devtools(..., { name: 'diagram-store' })))

## Update: P3.4 (F_SMOOTH)
- Deprecated: previous global smoothstep default.
- Now: default edges are straight with arrow markers and mlcd-stroke per UI spec.
- File: src/diagram/DiagramCanvas.tsx (ReactFlow props)


## Update: P4.1 (F_DETAIL)
- Sidebar data source refactored to tree structure (nested categories and items)
- Recursive rendering added for nested sections; search supports tree filtering
- File: src/components/Sidebar.tsx



## Update: P4.1 (F_DETAIL)
- Sidebar data source refactored to tree structure (nested categories and items)
- Recursive rendering added for nested sections; search supports tree filtering
- File: src/components/Sidebar.tsx
- Added new basic unit: Neuron node (CircleNode-based) under Core Layers ? Basic Units



## Update: P4.1 (F_DETAIL)
- Sidebar data source refactored to tree structure (nested categories and items)
- Recursive rendering added for nested sections; search supports tree filtering
- File: src/components/Sidebar.tsx
- Added new basic unit: Neuron node (CircleNode-based) under Core Layers -> Basic Units
- Added new item: MLP Layers (Core Layers -> Linear & Activation)



## Update: P4.1 (F_DETAIL)
- Added new category: ????? (Auxiliary Layers) with subgroup ????? (Regularization) and item Dropout
- Added new category: ???? (Activation Functions) ? ??????,?? Tanh?Sigmoid
- File: src/components/Sidebar.tsx

## Update: Activation Icons (Tanh/Sigmoid)
- Added function-specific circular icons:
  - src/assets/icons/TanhIcon.tsx (saturating tanh-like curve)
  - src/assets/icons/SigmoidIcon.tsx (logistic-like curve)
- Sidebar wired to use new icons for Tanh/Sigmoid


## Update: New Node & Icon — Neuron
- Added solid-circle Neuron icon and node type
- Files:
  - src/assets/icons/NeuronIcon.tsx
  - src/nodes/NeuronNode.tsx (solid filled circle, resizable)
  - src/diagram/DiagramCanvas.tsx (registered as neuronNode)
  - src/components/Sidebar.tsx (Neuron now uses neuronNode + NeuronIcon)

## Update: MLP Layers Node
- Added custom MLP node (rectangle with internal neuron dots, resizable)
- New icon for MLP: src/assets/icons/MLPIcon.tsx
- Files:
  - src/nodes/MLPNode.tsx (rows×cols small dots rendered in SVG)
  - src/diagram/DiagramCanvas.tsx (registered as mlpNode)
  - src/components/Sidebar.tsx (MLP Layers now uses mlpNode + MLPIcon)


## Update: Dropout Node Visualization
- Added custom Dropout node (rectangle with random dots and diagonal slashes pattern)
- Files:
  - src/nodes/DropoutNode.tsx
  - src/diagram/DiagramCanvas.tsx (registered as dropoutNode)
  - src/components/Sidebar.tsx (Dropout now uses dropoutNode)


## Update: P4.1 (F_DETAIL) — Sidebar Recursive Rendering
- Refactored src/components/Sidebar.tsx to render multi-level menu recursively with collapsible sections
- Added Section component handling nested categories (children) and items



### ?????(P3/P5)
- [ ] P3.2(???)
- [ ] P3.3(???)
- [ ] P5.1(???)
## Update: P5.1 (F_TEMPLATE)

## Visual & Naming Spec (Draft)
- Central tokens: `src/ui/tokens.ts`; Tailwind theme extended with `semantic.*` colors.
- Node role ? default color mapping documented in `docs/ui-spec.md`.
- Naming: PascalCase node components; `data.typeLabel` shows family; keep KaTeX/MathText.
- SVG-first: prefer inline SVG for visuals; current nodes partially use CSS borders — will migrate gradually.
- Added a templates data module with 3 presets (nodes/edges JSON):
  - Basic CNN Block, Basic RNN Cell, Attention Mechanism
- File: `src/data/templates.ts`
- Sidebar integration: added a Templates category with clickable items to insert templates — `src/components/Sidebar.tsx`
 - Drag/Click load: clicking a template inserts it centered in the viewport; dragging drops it at cursor point. Inserted nodes are pre-selected for immediate move/edit.
   - Handlers: `src/diagram/DiagramCanvas.tsx` listens to `mlcd-insert-template` event and performs centered insertion.

## Update: P7.0 (P2.1) — Sidebar Scroll Lock
- Fixed sidebar overflow causing page scroll. Sidebar now scrolls independently while canvas stays fixed.
- Changes:
  - `src/components/Sidebar.tsx`: root container set to `h-full min-h-0 overflow-y-auto overscroll-contain` (grid-friendly scroll).

## Update: P7.0 (P1.2) — Lasso Selection
- Enabled box selection on drag (lasso) with partial inclusion mode; disabled panning on left-drag
- Changes: `src/diagram/DiagramCanvas.tsx` ? `selectionOnDrag={true}`, `selectionMode=SelectionMode.Partial`, `panOnDrag={false}`

## Update: P7.0 (P1.1) — Sidebar Architecture Refactor
- Implemented strict three-level catalog for Sidebar per final UI spec
  - New single source of truth: `src/data/sidebarData.ts`
  - Sidebar renders from catalog (no hardcoded/duplicated lists)
  - Only minimal primitives + Templates present (loop structures like RNN/LSTM removed from primitives)
- I18N
  - Category titles localized via keys: `sidebar.<id>.title`
  - Technical item labels (FC Layer, BatchNorm, ReLU, etc.) remain English in zh locale
- Files:
  - src/data/sidebarData.ts (NEW)
  - src/components/Sidebar.tsx (refactored to consume catalog)
  - src/i18n/locales/zh/translation.json (added sidebar.* titles)

## Update: P7.0 (P1.1/P3.1) — Toolbar Simplification & Alignment Fixes
- Consolidated alignment/distribution actions into a dropdown to reduce icon clutter
- Validated and improved distribution to space by node centers for more natural layouts
- Changes:
  - `src/components/AlignmentDropdown.tsx` (NEW): grouped actions UI
  - `src/components/Toolbar.tsx`: replaced multiple icons with the dropdown, removed secondary clusters
  - `src/diagram/alignment.ts`: distribute() now uses centers; kept AlignLeft/AlignTop as primary actions
  - Group/Ungroup controls temporarily hidden until feature integration is verified (prevent crash)

## Update: P7.0 (Hotfix) — Group Selection Crash
- Fixed parent-child mount order when creating groups (parent first), preventing crash on group action
- Removed invalid SVG paths from `GroupNode` that could trigger rendering issues
- Changes:
  - `src/diagram/DiagramState.ts`: groupSelectedIntoNewGroup now inserts parent before children
  - `src/diagram/grouping.ts`: setNodes parent-first
   - `src/nodes/GroupNode.tsx`: removed calc() path decorations; cleaned collapse glyph

## Update: P7.1 (Wave 1 Foundations)
- Node schemas and schema-driven PropertiesPanel
  - `src/ui/nodeSchemas.ts` (NEW): registry for activation/conv/fc/tensor
  - `src/components/PropertiesPanel.tsx`: renders schema fields and updates node data
- Canvas toasts
  - `src/diagram/DiagramState.ts`: emits `mlcd-group-created`
  - `src/diagram/DiagramCanvas.tsx`: unified toast handling (template + group)
- Consolidation
  - `src/diagram/grouping.ts`: single source helpers; parent-first ordering
  - `src/diagram/DiagramState.ts`: delegates to helpers
- Build cleanup
  - Removed unused React imports, fixed mojibake in ActivationNode, ensured green build


