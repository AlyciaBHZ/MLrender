# 项目总纲 — Airender / ML Concept Designer (ML-CD)

## 一、项目简介
- 项目代号：Airender（仓库名），产品名：ML Concept Designer（ML‑CD）。
- 定位：一个开源、免费、基于 Web 的工具，专注于生成高清晰度、专业且具有出版质量的机器学习概念图和系统架构图。
- 当前形态：纯前端单页应用（SPA），无后端依赖，可本地运行与构建静态产物部署。

## 二、项目愿景与预期目标 (Vision and Aspiration)
- 核心愿景：成为机器学习、数据科学和人工智能领域研究人员、学生和工程师的**BioRender**。
- 核心目标：
  - 低门槛搭建常见网络结构（Input/FC/Conv/Pooling/RNN/Output/Loss/Optimizer 等）。
  - 一键导出/导入多种格式（JSON、CSV、PNG）以便分享、归档与文档沉淀。
  - 轻量、快速、可离线工作，适配教学、方案沟通与原型设计。
- 解决痛点：致力于解决现有通用制图工具（如 PPT、Visio、Draw.io）在绘制抽象的 ML 概念图时专业图标缺失、效率低下、风格不统一的痛点。
- 演进路径：最初将以拖拽式（Drag-and-Drop）编辑器为核心，长期目标是集成 AI Prompt-to-Diagram 功能，实现“描述即成图”。

## 三、目标用户与典型场景
- 目标用户：
  - 教学与培训：课程讲师、助教、学生。
  - 研发与方案：算法工程师、研究员、产品/架构沟通角色。
- 典型场景：
  - 课堂/文档中绘制模型结构示意并导出 PNG 插图。
  - 学生和研究人员：快速制作论文、海报和毕业设计的插图。
  - 工程师和布道师：绘制模型架构、数据流和系统设计，用于文档和演示。
  - 方案评审前用 JSON/CSV 交换结构草图，便于版本管理。
  - 头脑风暴时快速拖拽组件，标注关键参数（通道、尺寸、激活等）。

## 四、范围与非范围
- 范围（Scope）：
  - 可视化节点与边的创建、拖拽、连接、样式与标注。
  - 残差/箭头等多样边类型，基础对齐与布局辅助。
  - 导入导出：JSON、CSV（nodes.csv/edges.csv）、PNG（画布截图）。
  - 快捷键支持，属性面板编辑，基础配色与尺寸控制。
- 非范围（Out of Scope）：
  - 不进行训练/推理，不生成可执行训练代码。
  - 不内置云端存储/协作（可后续规划为可选增强）。
  - 不保证与任意框架定义的图语义完全等价（以“草图/示意”为主）。

## 五、关键功能（MVP 已具备）
- 节点类型：Input/FC/Conv/Pooling/RNN/Output/Loss/Optimizer 等常见组件。
- 边类型：普通/箭头/残差边，支持样式与锚点。
- 画布交互：拖拽、缩放、对齐辅助、节点/边选择与删除。
- 属性编辑：侧边栏/属性面板内编辑标签、颜色、尺寸等。
- 数据交换：
  - JSON：保存/加载整图 `{ nodes, edges }`。
  - CSV：`nodes.csv` 与 `edges.csv` 双表互相导入导出。
  - PNG：基于 DOM 截图导出画布为图片。
- 快捷键：保存/打开/导出等常用操作（详见应用内提示与 README）。

## 六、后续功能路线图（建议优先级）
1. 体验与易用性（P0）
   - 更完善的撤销/重做、对齐/分布与吸附、智能连线提示。
   - 预设模板库（常见 CNN/RNN/Transformer 结构片段）。
2. 表达能力（P0–P1）
   - 分组/子图/模块化复用，跨图引用。
   - 自动布局（层次、网格、力导），长图导航与折叠。
3. 数据与互操作（P1）
   - 丰富节点属性（通道数、核尺寸、步幅等）与校验。
   - 导出到更多格式（Mermaid、SVG），以及只读分享链接。
4. 协作与管理（P2）
   - 云端存储、版本快照、评论标注与多人协作（需后端）。
5. 国际化与无障碍（P2）
   - i18n（中/英切换）、键盘导航与可访问性增强。
6. 智能生成（P2–P3）
   - Prompt-to-Diagram：自然语言/提示词生成概念图与架构图。
   - 语义检查与建议：根据描述补全常见连接与参数，减少机械操作。

## 七、技术架构与目录（现状）
### 项目核心技术栈 (Core Technology Stack)
项目将采用现代、高性能、社区支持良好的技术栈，以确保可维护性和未来扩展性：
- 语言与运行时：TypeScript 5 + Node.js 18+
- 前端框架：React 18
- 构建工具：Vite 5 + @vitejs/plugin-react（ESM，冷启动与热更新迅速）
- 样式系统：Tailwind CSS 3 + PostCSS + Autoprefixer
- 图编辑引擎：React Flow 11（节点/边、缩放、选择、DnD）
- 状态管理：Zustand 4（图数据与 UI 状态）
- 图像导出：html-to-image（PNG 导出）

### 技术栈核心优势
- 前端框架：React + TypeScript 保证代码质量、类型安全和组件化开发。
- 构建工具：Vite 极速开发和构建体验。
 - 画布引擎：React Flow 专注于图表结构和交互（节点、连接、缩放）。
 - 样式：Tailwind CSS 快速、一致地应用专业美观的 UI 样式。
 - 状态管理：Zustand 轻量级、简洁的状态管理，避免过度复杂化。
 - 性能与开发效率：Vite 原生 ESM + HMR，冷启动与热更新极快；React 18 并发能力为复杂交互奠基。
- 可维护性与类型安全：TypeScript 5 约束节点/边模型与组件接口，减少回归，提升重构信心。
- 可视化生态成熟：React Flow 提供稳定的节点/边、视口与交互抽象，降低自研图引擎成本与风险。
- 轻量状态管理：Zustand API 简洁、无样板，支持选择器优化与状态分片，性能可控。
- 一致性与出图质量：Tailwind 建立约束式设计体系；html-to-image 生成高清 PNG，适配文档/出版。
- 构建与部署：Vite/Rollup 产物体积小，可静态托管部署；纯前端架构支持离线使用与易于集成。
- 扩展性：自定义节点/边与插件能力易扩展；后续可平滑新增 SVG/Mermaid 导出与 Prompt‑to‑Diagram。
- 跨平台与社区：现代浏览器兼容性好；依赖库社区活跃、维护稳定，降低长期维护成本。

### 目录要点（参考）
  - `src/diagram/DiagramCanvas.tsx` 画布与交互封装。
  - `src/diagram/DiagramState.ts` 全局状态（nodes/edges/选中等）。
  - `src/nodes/*` 各类节点的渲染与样式。
  - `src/edges/*` 自定义边（例如残差边）。
  - `src/components/*` 侧边栏、工具栏、属性面板等 UI 组件。
  - `src/sheets/*` 导入导出（CSV/JSON）与表头定义。

## 八、数据模型与文件格式
- 内部节点（示意）：
  - 基于 React Flow `Node`，常用字段：`id | type | data | position | width | style` 等。
- 内部边（示意）：
  - 基于 React Flow `Edge`，常用字段：`id | source | target | type | markerEnd | style` 等。
- CSV 表头（来自 `src/sheets/schema.ts`）：
  - Nodes：`id, type, label, color, width, x, y`
  - Edges：`id, source, target, type, stroke, arrow, residual`
- JSON：
  - 采用 `{ nodes, edges }` 结构与 React Flow 兼容；用于完整存档与恢复。
- PNG：
  - 使用 DOM 渲染截图（如 html-to-image），便于在文档与幻灯片中使用。

## 九、交互与可用性基线
- 快捷键：保存/打开/导出等常用键位；删除键删除所选元素。
- 选择：支持单选/多选；提供对齐辅助线与吸附手感（可逐步增强）。
- 属性编辑：侧栏/面板集中编辑，保持所见即所得的即时反馈。

## 十、非功能需求
- 性能：中等规模（数百节点）交互流畅；导出操作秒级完成。
- 兼容：现代浏览器（Chromium/Firefox/Safari 最新两个大版本）。
- 稳定：异常导入/无效数据需有错误提示与兜底策略。
- 可维护：组件与状态解耦，类型约束清晰，目录结构稳定。

## 十一、里程碑（建议）
- M0（现状）：MVP 功能齐备，支持核心节点/边与三类导入导出。
- M1（2–4 周）：交互细节打磨（对齐/吸附/撤销重做）、模板片段。
- M2（4–8 周）：分组与自动布局、属性校验与参数化展示。
- M3（8–12 周）：导出更多格式、分享链接与基础只读查看。

## 十二、主要风险与对策
- 大图场景性能与内存占用：分片渲染、虚拟化、按需重排与绘制。
- 误操作与数据丢失：本地自动保存/快照、显式确认与撤销重做。
- 编码与导出兼容性：统一编码（UTF‑8）、跨浏览器导出回归测试。
- 语义歧义：以“草图示意”为基线，明确与训练图/部署图的差异。

## 十三、度量指标（可选）
- 使用留存：本地草图保存/再次打开频次。
- 产出效率：从空白到可用结构图的平均耗时。
- 稳定质量：导入/导出错误率与崩溃率（本地日志/反馈）。

## 十四、发布与运维
- 本地开发：`npm install && npm run dev`（Node.js 18+）。
- 构建发布：`npm run build` 生成静态资源，可部署任意静态托管。
- 版本策略：语义化版本；以功能集与兼容性为边界制定变更日志。

## 十五、协作与规范
- 代码风格：TypeScript + React 组件化，避免过度耦合；保持小而清晰的组件层次。
- 目录约定：节点/边/画布/状态/导入导出/样式分层清晰，命名可读。
- 文档：对外 README 与用户指南、对内开发笔记与变更记录。

## 十六、项目分阶段规划 (Phased Development Plan)
项目将分阶段实施，确保 MVP 快速交付，并为高级功能保留扩展性。

- 阶段状态（进度概览）
  - 阶段一：最小可行产品（MVP）— 已大部分完成（Part 1–4）。
  - 重点：基础功能与核心 UI 搭建（拖拽、节点/边、属性面板、导入导出等）。
  - 注：本纲中“Phase 0 — MVP”与“阶段一 — MVP”语义一致。
  - 当前阶段目标：Part 5 核心功能实现。

- Phase 0 — MVP（0–2 周）
  - 拖拽式编辑器：核心节点（Input/FC/Conv/Pooling/RNN/Output/Loss/Optimizer）与边（含残差/箭头）。
  - 画布交互：选择/移动/缩放、基础对齐辅助、删除与快捷键。
  - 属性编辑：侧边栏/属性面板，颜色、尺寸、标签等。
  - 导入导出：
    - JSON：保存/加载 `{ nodes, edges }`。
    - Export to Sheets（CSV）：生成 `nodes.csv` 与 `edges.csv`；支持从 CSV 导入。
    - PNG：基于 html-to-image 导出高清截图。
  - 文档与引导：快速上手与示例；基础图标与风格规范。

- Phase 1 — 体验增强（2–4 周）
  - 交互细节：撤销/重做、吸附与分布、智能连线提示与批量操作。
  - 模板与片段：常见 CNN/RNN/Transformer 片段；库内复用与快速插入。
  - 视觉一致性：统一配色/网格/间距规范，标准化专业图标集。
  - Export to Sheets 增强：
    - 更健壮的 CSV 校验与错误提示；可选列映射与缺省处理。
    -（可选）与 Google Sheets 的一键同步（需后端/OAuth，按条件推进）。

- Phase 2 — 表达力与互操作（4–8 周）
  - 分组/子图/模块化复用，长图导航与折叠。
  - 自动布局：层次/网格/力导等；参数化节点与属性校验。
  - 导出扩展：SVG、Mermaid、只读分享链接（纯前端 URL 编码或静态托管）。

- Phase 3 — 智能生成（8–12 周）
  - Prompt‑to‑Diagram：用自然语言生成概念图/架构图。
  - 语义建议：自动补全常见连接、参数与一致性检查，降低机械操作。

验收与度量（各阶段）
- 功能验收：以“操作用例 + 导入导出样例”作为交付物隐藏测试集。
- 质量指标：出图清晰度、导入导出成功率、交互帧率、崩溃率。
- 体验指标：从空白到可用图的平均耗时、撤销重做覆盖率。

## 十七、AI Agent 角色与核心自监督机制
### 角色与权限
- 角色：全栈软件架构师，专注 React/TypeScript 与专业图表应用。
- 权限：获授权对代码库进行架构与实现层面的修改，以达成规划目标。

### 执行优先级原则
- 优先级顺序：P0 > P1 > P2 > P3；任何时间优先保证稳定性与数据安全。
- 对应阶段：优先完成“Phase 0（MVP）/阶段一”缺口，再推进 Phase 1/2/3。
- 变更策略：小步快跑，变更最小化，聚焦单一目标，避免牵一发而动全身。

### 核心自监督机制
- 需求对齐：为每个任务明确“目标/范围/验收标准/非目标”，避免需求漂移。
- 计划-执行-验证闭环：
  - 计划：拆解为可验证的小步骤（仅一个 in_progress）。
  - 执行：最小影响原则，保持代码风格与目录约定一致。
  - 验证：本地构建通过、主要路径可用、导入导出正确、关键交互无回归。
- 类型与构建约束：
  - TypeScript 严格依赖类型，避免 `any` 与未定义可空路径。
  - 本地构建 `npm run build` 需通过；若失败需先修复当前改动导致的问题。
- 数据格式校验：
  - CSV/JSON 与 `src/sheets/schema.ts` 表头/结构保持一致；导入失败需有可读错误信息。
  - 导出 JSON 采用 `{ nodes, edges }` 结构，字段完整且与 React Flow 兼容。
- 功能自检清单（MVP 基线）：
  - 画布：拖拽/缩放/选择/删除；对齐辅助线；残差/箭头边渲染正确。
  - 属性：侧栏/面板编辑标签、颜色、尺寸即时生效。
  - 导入导出：JSON 保存/加载一致；CSV nodes/edges 双向互导；PNG 清晰无裁切。
  - 快捷键：保存/打开/导出、删除键等基本可用。
- 变更影响与回滚：
  - 评估对节点/边渲染、状态管理、导入导出三个关键面的影响。
  - 引入新能力时保持向后兼容；必要时提供迁移路径或版本标记。
- 文档同步：
  - 重要行为与接口变化需同步到 `docs/项目总纲.md` 或 README 的相应章节。
  - 新增能力提供最小示例与使用说明，便于验证与传播。

### 交付物标准（每次改动应满足）
- 可运行：开发与构建脚本可通过，关键用户路径可操作。
- 可理解：命名清晰、结构稳定；必要说明更新在文档内。
- 可回退：单一目标的最小变更，便于定位与回滚。
